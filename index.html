<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA設定 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="21:9 Clock">
    <link rel="manifest" id="manifest-placeholder">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23f4f4f4'/%3E%3Ccircle cx='256' cy='256' r='200' fill='none' stroke='%231a1a1a' stroke-width='40'/%3E%3Cline x1='256' y1='256' x2='256' y2='100' stroke='%231a1a1a' stroke-width='30' stroke-linecap='round'/%3E%3Cline x1='256' y1='256' x2='380' y2='256' stroke='%23666666' stroke-width='20' stroke-linecap='round'/%3E%3Ccircle cx='256' cy='256' r='20' fill='%231a1a1a'/%3E%3C/svg%3E">
    
    <title>Monotone Clock & Weather</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&family=Noto+Sans+JP:wght@400;700&display=swap');

        :root {
            --bg-base: #f4f4f4;
            --bg-gradient: #ffffff;
            --ink-black: #1a1a1a;
            --slate-gray: #666666;
            --soft-gray: #e0e0e0;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--bg-base);
            background: radial-gradient(circle at center, var(--bg-gradient) 0%, var(--bg-base) 100%);
            color: var(--ink-black);
            font-family: 'Poppins', 'Noto Sans JP', sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            cursor: pointer;
        }

        /* 全体を左右に分けるコンテナ */
        .main-layout {
            display: flex;
            width: 90vw;
            height: 100vh;
            margin: 0 auto;
            align-items: center;
            justify-content: space-between;
        }

        /* --- 左側：時計エリア (60%) --- */
        .clock-container {
            width: 60%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start; /* 左寄せ */
            position: relative;
            z-index: 10;
            animation: float 6s ease-in-out infinite;
        }

        .date-section {
            font-size: 2vw;
            font-weight: 300;
            letter-spacing: 0.15em;
            color: var(--slate-gray);
            margin-bottom: -1vh;
            display: flex;
            gap: 1vw;
            opacity: 0.9;
            padding-left: 0.5vw; /* 微調整 */
        }

        .day-highlight {
            font-weight: 600;
            color: var(--ink-black);
        }

        .time-wrapper {
            display: flex;
            align-items: baseline;
            line-height: 1;
            margin-top: 1vh;
        }

        .time-section {
            font-size: 16vw; /* サイズ調整 */
            font-weight: 800;
            letter-spacing: -0.04em;
            color: var(--ink-black);
            font-variant-numeric: tabular-nums;
            text-shadow: 0 10px 40px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
        }

        .separator {
            opacity: 0.15;
            margin: 0 0.4vw; 
            transform: translateY(-1.2vw);
        }

        .seconds {
            font-size: 6vw; /* サイズ調整 */
            font-weight: 600;
            color: var(--slate-gray);
            margin-left: 1.5vw;
            font-variant-numeric: tabular-nums;
            opacity: 0.8;
        }

        /* --- 右側：天気エリア (40%) --- */
        .weather-container {
            width: 35%; /* 余白を見て少し小さめに */
            display: flex;
            flex-direction: column;
            align-items: center; /* 中央寄せ */
            justify-content: center;
            padding-left: 2vw;
            border-left: 2px solid rgba(0,0,0,0.05); /* 区切り線 */
            color: var(--ink-black);
            animation: fadeIn 2s ease-out;
        }

        .weather-location {
            font-size: 1.2vw;
            letter-spacing: 0.2em;
            color: var(--slate-gray);
            margin-bottom: 2vh;
            text-transform: uppercase;
        }

        .weather-icon-box {
            width: 10vw;
            height: 10vw;
            margin-bottom: 1vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* 天気アイコンSVGのスタイル */
        .weather-svg {
            width: 100%;
            height: 100%;
            fill: var(--ink-black);
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
        }

        .weather-temp {
            display: flex;
            align-items: baseline;
            gap: 1.5vw;
            font-family: 'Poppins', sans-serif;
        }

        .temp-high {
            font-size: 5vw;
            font-weight: 800;
        }

        .temp-low {
            font-size: 3vw;
            font-weight: 600;
            color: var(--slate-gray);
            opacity: 0.7;
        }
        
        .weather-desc {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 1.5vw;
            margin-top: 1vh;
            font-weight: 700;
        }

        /* 下部のプログレスバー */
        .progress-bar-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: var(--soft-gray);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #888888, #1a1a1a);
            width: 0%;
            border-radius: 0 4px 4px 0;
            transition: width 0.1s linear;
        }

        .hint-text {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: var(--slate-gray);
            opacity: 0.3;
            transition: opacity 0.5s;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body onclick="toggleFullScreen()">

    <div id="hint" class="hint-text">TAP TO FULLSCREEN</div>

    <div class="main-layout">
        <!-- 左側：時計 -->
        <div class="clock-container">
            <div class="date-section">
                <span id="date">LOADING</span>
                <span id="day" class="day-highlight"></span>
            </div>

            <div class="time-wrapper">
                <div class="time-section">
                    <span id="hours">00</span>
                    <span class="separator">:</span>
                    <span id="minutes">00</span>
                </div>
                <div class="seconds" id="seconds">00</div>
            </div>
        </div>

        <!-- 右側：天気 (新潟県新発田市 -> 下越) -->
        <div class="weather-container">
            <div class="weather-location">SHIBATA, NIIGATA</div>
            <div class="weather-icon-box" id="weather-icon">
                <!-- SVGがここに挿入されます -->
                <span style="font-size:2vw; opacity:0.5;">...</span>
            </div>
            <div class="weather-temp">
                <span class="temp-high" id="temp-max">--</span>
                <span class="temp-low" id="temp-min">--</span>
            </div>
            <div class="weather-desc" id="weather-text">Loading</div>
        </div>
    </div>

    <div class="progress-bar-container">
        <div class="progress-bar" id="progress"></div>
    </div>

    <script>
        // --- PWA設定 ---
        function setupManifest() {
            const iconData = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%23f4f4f4'/%3E%3Ccircle cx='256' cy='256' r='200' fill='none' stroke='%231a1a1a' stroke-width='40'/%3E%3Cline x1='256' y1='256' x2='256' y2='100' stroke='%231a1a1a' stroke-width='30' stroke-linecap='round'/%3E%3Cline x1='256' y1='256' x2='380' y2='256' stroke='%23666666' stroke-width='20' stroke-linecap='round'/%3E%3Ccircle cx='256' cy='256' r='20' fill='%231a1a1a'/%3E%3C/svg%3E";
            const manifest = {
                "name": "Monotone Clock",
                "short_name": "Clock",
                "start_url": ".",
                "display": "fullscreen",
                "background_color": "#f4f4f4",
                "theme_color": "#f4f4f4",
                "orientation": "landscape",
                "icons": [{ "src": iconData, "sizes": "512x512", "type": "image/svg+xml" }]
            };
            const blob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
            document.querySelector('#manifest-placeholder').setAttribute('href', URL.createObjectURL(blob));
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(e=>{});
                document.getElementById('hint').style.opacity = '0';
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }

        // --- 時計処理 ---
        function updateClock() {
            const now = new Date();
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const pad = (num) => String(num).padStart(2, '0');

            const year = now.getFullYear();
            const monthName = months[now.getMonth()];
            const date = pad(now.getDate());
            const dayName = days[now.getDay()];

            const h = pad(now.getHours());
            const m = pad(now.getMinutes());
            const s = pad(now.getSeconds());
            const progressPercent = ((now.getSeconds() + now.getMilliseconds() / 1000) / 60) * 100;

            document.getElementById('date').textContent = `${monthName} ${date}, ${year}`;
            document.getElementById('day').textContent = dayName;
            document.getElementById('hours').textContent = h;
            document.getElementById('minutes').textContent = m;
            document.getElementById('seconds').textContent = s;
            document.getElementById('progress').style.width = `${progressPercent}%`;
        }

        // --- 天気予報処理 (気象庁API) ---
        // 新潟県コード: 150000, 下越エリアコード: 150010
        const JMA_URL = "https://www.jma.go.jp/bosai/forecast/data/forecast/150000.json";

        // シンプルなSVGアイコンデータ
        const icons = {
            sun: `<svg class="weather-svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="14" stroke="currentColor" stroke-width="4" fill="none"/><path d="M32 6V12 M32 52V58 M58 32H52 M12 32H6 M50.4 13.6L46.1 17.9 M17.9 46.1L13.6 50.4 M50.4 50.4L46.1 46.1 M17.9 17.9L13.6 13.6" stroke="currentColor" stroke-width="4" stroke-linecap="round"/></svg>`,
            cloud: `<svg class="weather-svg" viewBox="0 0 64 64"><path d="M16 46H48C55.7 46 62 39.7 62 32C62 24.3 55.7 18 48 18C47.1 18 46.2 18.1 45.4 18.3C43.5 10.4 36.4 4.5 28 4.5C18.1 4.5 10 12.6 10 22.5C10 23.3 10.1 24 10.2 24.8C5.2 26.2 1.5 30.8 1.5 36.2C1.5 41.6 5.9 46 11.3 46H16Z" fill="none" stroke="currentColor" stroke-width="4" stroke-linejoin="round"/></svg>`,
            rain: `<svg class="weather-svg" viewBox="0 0 64 64"><path d="M16 40H48C55.7 40 62 33.7 62 26C62 18.3 55.7 12 48 12C47.1 12 46.2 12.1 45.4 12.3C43.5 4.4 36.4 -1.5 28 -1.5C18.1 -1.5 10 6.6 10 16.5C10 17.3 10.1 18 10.2 18.8C5.2 20.2 1.5 24.8 1.5 30.2C1.5 35.6 5.9 40 11.3 40H16Z" fill="none" stroke="currentColor" stroke-width="4"/><path d="M22 48L18 58 M32 48L28 58 M42 48L38 58" stroke="currentColor" stroke-width="4" stroke-linecap="round"/></svg>`,
            snow: `<svg class="weather-svg" viewBox="0 0 64 64"><path d="M32 12V52 M14 22L50 42 M14 42L50 22" stroke="currentColor" stroke-width="4" stroke-linecap="round"/><circle cx="32" cy="32" r="2" fill="currentColor"/></svg>`
        };

        async function fetchWeather() {
            try {
                const response = await fetch(JMA_URL);
                const data = await response.json();
                
                // 新潟県の下越エリア (150010) を探す
                // 1つ目のデータ群(forecasts[0])が天気概況
                const forecastArea = data[0].timeSeries[0].areas.find(a => a.area.code === "150010");
                const weatherCode = forecastArea.weatherCodes[0]; // 今日の天気コード
                const weatherText = forecastArea.weathers[0].replace(/\s+/g, ''); // "くもり　所により　雨" -> "くもり所により雨"

                // 2つ目のデータ群(forecasts[1])が気温 (0:新潟, 1:長岡, 2:高田, 3:相川 ... 新発田はないので新潟(150010の代表)を使う)
                // 正確には「新潟」観測所のデータを使います
                const tempArea = data[0].timeSeries[2].areas.find(a => a.area.code === "150010"); 
                // 気象庁JSONは朝取得すると「今日の最低」がない場合があるため、nullチェックが必要
                let maxT = tempArea.temps[1] || tempArea.temps[0] || "--"; 
                let minT = tempArea.temps[0] !== maxT ? tempArea.temps[0] : "--"; // 簡易ロジック

                // 表示更新
                updateWeatherUI(weatherCode, maxT, minT, weatherText);
                
            } catch (e) {
                console.error("Weather fetch failed", e);
                document.getElementById('weather-text').textContent = "Offline";
            }
        }

        function updateWeatherUI(code, max, min, text) {
            const iconBox = document.getElementById('weather-icon');
            const c = parseInt(code);
            let svg = icons.cloud; // デフォルト

            // 天気コード簡易判定
            if (code === '100' || code === '101' || (c >= 123 && c <= 139)) svg = icons.sun; // 晴れ系
            else if (c >= 200 && c <= 299) svg = icons.cloud; // 曇り系
            else if (c >= 300 && c <= 399) svg = icons.rain; // 雨系
            else if (c >= 400) svg = icons.snow; // 雪系

            iconBox.innerHTML = svg;
            document.getElementById('temp-max').textContent = max + "°";
            document.getElementById('temp-min').textContent = min !== "--" ? min + "°" : "/";
            
            // 日本語の天気概況を少し短くする（「くもり　所により　雨」など長いので）
            const shortText = text.split('　')[0].split('所により')[0]; 
            document.getElementById('weather-text').textContent = shortText;
        }

        // 初期化
        setupManifest();
        setInterval(updateClock, 30);
        updateClock();
        fetchWeather(); // 初回実行
        setInterval(fetchWeather, 1800000); // 30分ごとに更新
    </script>
</body>
</html>
